import{_ as s,o as n,c as a,a as l}from"./app.f983686f.js";const p="/blog/assets/2024-04-15-11-10-48.0adbb1ac.png",o="/blog/assets/2024-04-15-11-37-55.b8c61089.png",e="/blog/assets/2024-04-15-11-45-10.5b79fe3e.png",u=JSON.parse('{"title":"ğŸ”¥ æ‰‹æ’• babel æ’ä»¶-æ¶ˆç­ consoleï¼","description":"","frontmatter":{},"headers":[{"level":2,"title":"åˆè§ AST","slug":"åˆè§-ast","link":"#åˆè§-ast","children":[{"level":3,"title":"Program","slug":"program","link":"#program","children":[]},{"level":3,"title":"ExpressionStatement","slug":"expressionstatement","link":"#expressionstatement","children":[]},{"level":3,"title":"CallExpression","slug":"callexpression","link":"#callexpression","children":[]},{"level":3,"title":"MemberExpression","slug":"memberexpression","link":"#memberexpression","children":[]},{"level":3,"title":"Identifier","slug":"identifier","link":"#identifier","children":[]},{"level":3,"title":"StringLiteral","slug":"stringliteral","link":"#stringliteral","children":[]},{"level":3,"title":"å…¬å…±å±æ€§","slug":"å…¬å…±å±æ€§","link":"#å…¬å…±å±æ€§","children":[]}]},{"level":2,"title":"å¦‚ä½•å†™ä¸€ä¸ª babel æ’ä»¶ï¼Ÿ","slug":"å¦‚ä½•å†™ä¸€ä¸ª-babel-æ’ä»¶","link":"#å¦‚ä½•å†™ä¸€ä¸ª-babel-æ’ä»¶","children":[]},{"level":2,"title":"æ„é€  visitor æ–¹æ³•","slug":"æ„é€ -visitor-æ–¹æ³•","link":"#æ„é€ -visitor-æ–¹æ³•","children":[]},{"level":2,"title":"å»é™¤æ‰€æœ‰ console","slug":"å»é™¤æ‰€æœ‰-console","link":"#å»é™¤æ‰€æœ‰-console","children":[]},{"level":2,"title":"å¢åŠ  env api","slug":"å¢åŠ -env-api","link":"#å¢åŠ -env-api","children":[]},{"level":2,"title":"å¢åŠ  exclude api","slug":"å¢åŠ -exclude-api","link":"#å¢åŠ -exclude-api","children":[]},{"level":2,"title":"å¢åŠ  commentWords api","slug":"å¢åŠ -commentwords-api","link":"#å¢åŠ -commentwords-api","children":[]},{"level":2,"title":"ç»†èŠ‚å®Œå–„","slug":"ç»†èŠ‚å®Œå–„","link":"#ç»†èŠ‚å®Œå–„","children":[{"level":3,"title":"å¯¹äºåç¼€æ³¨é‡Š","slug":"å¯¹äºåç¼€æ³¨é‡Š","link":"#å¯¹äºåç¼€æ³¨é‡Š","children":[]},{"level":3,"title":"å¯¹äºå‰ç¼€æ³¨é‡Š","slug":"å¯¹äºå‰ç¼€æ³¨é‡Š","link":"#å¯¹äºå‰ç¼€æ³¨é‡Š","children":[]}]}],"relativePath":"fragment/babel-console.md","lastUpdated":1713158613000}'),c={name:"fragment/babel-console.md"},r=l('<h1 id="ğŸ”¥-æ‰‹æ’•-babel-æ’ä»¶-æ¶ˆç­-console" tabindex="-1">ğŸ”¥ æ‰‹æ’• babel æ’ä»¶-æ¶ˆç­ consoleï¼ <a class="header-anchor" href="#ğŸ”¥-æ‰‹æ’•-babel-æ’ä»¶-æ¶ˆç­-console" aria-hidden="true">#</a></h1><p>å†™ä¸€ä¸ªå°æ’ä»¶æ¥å»é™¤ ç”Ÿäº§ç¯å¢ƒ çš„ console.log</p><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯ å»é™¤ console.log ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡ ast æŸ¥çœ‹è¯­æ³•æ ‘çš„ç»“æ„ã€‚æˆ‘ä»¬ä»¥ä¸‹é¢çš„ console ä¸ºä¾‹ï¼š æ³¨æ„ å› ä¸ºæˆ‘ä»¬è¦å†™ babel æ’ä»¶ æ‰€ä»¥æˆ‘ä»¬é€‰æ‹© @babel/parser åº“ç”Ÿæˆ astï¼Œå› ä¸º babel å†…éƒ¨æ˜¯ä½¿ç”¨è¿™ä¸ªåº“ç”Ÿæˆ ast çš„</p><p><img src="'+p+`" alt=""></p><h2 id="åˆè§-ast" tabindex="-1">åˆè§ AST <a class="header-anchor" href="#åˆè§-ast" aria-hidden="true">#</a></h2><p>AST æ˜¯å¯¹æºç çš„æŠ½è±¡ï¼Œå­—é¢é‡ã€æ ‡è¯†ç¬¦ã€è¡¨è¾¾å¼ã€è¯­å¥ã€æ¨¡å—è¯­æ³•ã€class è¯­æ³•éƒ½æœ‰å„è‡ªçš„ ASTã€‚</p><h3 id="program" tabindex="-1">Program <a class="header-anchor" href="#program" aria-hidden="true">#</a></h3><p>program æ˜¯ä»£è¡¨æ•´ä¸ªç¨‹åºçš„èŠ‚ç‚¹ï¼Œå®ƒæœ‰ body å±æ€§ä»£è¡¨ç¨‹åºä½“ï¼Œå­˜æ”¾ statement æ•°ç»„ï¼Œå°±æ˜¯å…·ä½“æ‰§è¡Œçš„è¯­å¥çš„é›†åˆã€‚ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œçš„ body åªæœ‰ä¸€ä¸ª ExpressionStatement è¯­å¥ï¼Œå³ console.logã€‚</p><h3 id="expressionstatement" tabindex="-1">ExpressionStatement <a class="header-anchor" href="#expressionstatement" aria-hidden="true">#</a></h3><p>statement æ˜¯è¯­å¥ï¼Œå®ƒæ˜¯å¯ä»¥ç‹¬ç«‹æ‰§è¡Œçš„å•ä½ï¼Œexpression æ˜¯è¡¨è¾¾å¼ï¼Œå®ƒä¿©å”¯ä¸€çš„åŒºåˆ«æ˜¯è¡¨è¾¾å¼æ‰§è¡Œå®Œä»¥åæœ‰è¿”å›å€¼ã€‚æ‰€ä»¥ ExpressionStatement è¡¨ç¤ºè¿™ä¸ªè¡¨è¾¾å¼æ˜¯è¢«å½“ä½œè¯­å¥æ‰§è¡Œçš„ã€‚ ExpressionStatement ç±»å‹çš„ AST æœ‰ä¸€ä¸ª expression å±æ€§ï¼Œä»£è¡¨å½“å‰çš„è¡¨è¾¾å¼ã€‚</p><h3 id="callexpression" tabindex="-1">CallExpression <a class="header-anchor" href="#callexpression" aria-hidden="true">#</a></h3><p>expression æ˜¯è¡¨è¾¾å¼ï¼ŒCallExpression è¡¨ç¤ºè°ƒç”¨è¡¨è¾¾å¼ï¼Œconsole.log å°±æ˜¯ä¸€ä¸ªè°ƒç”¨è¡¨è¾¾å¼ã€‚ CallExpression ç±»å‹çš„ AST æœ‰ä¸€ä¸ª callee å±æ€§ï¼ŒæŒ‡å‘è¢«è°ƒç”¨çš„å‡½æ•°ã€‚è¿™é‡Œ console.log å°±æ˜¯ callee çš„å€¼ã€‚ CallExpression ç±»å‹çš„ AST æœ‰ä¸€ä¸ª arguments å±æ€§ï¼ŒæŒ‡å‘å‚æ•°ã€‚è¿™é‡Œâ€œæˆ‘ä¼šè¢«æ¸…é™¤â€å°±æ˜¯ arguments çš„å€¼ã€‚</p><h3 id="memberexpression" tabindex="-1">MemberExpression <a class="header-anchor" href="#memberexpression" aria-hidden="true">#</a></h3><p>Member Expression é€šå¸¸æ˜¯ç”¨äºè®¿é—®å¯¹è±¡æˆå‘˜çš„ã€‚ä»–æœ‰å‡ ç§å½¢å¼ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#E5C07B;">a</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">b</span></span>
<span class="line"><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;b&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">target</span></span>
<span class="line"><span style="color:#E5C07B;font-style:italic;">super</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">b</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#79B8FF;">a</span><span style="color:#B392F0;">.b</span></span>
<span class="line"><span style="color:#B392F0;">a[</span><span style="color:#FFAB70;">&quot;b&quot;</span><span style="color:#B392F0;">]</span></span>
<span class="line"><span style="color:#F97583;">new</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">target</span></span>
<span class="line"><span style="color:#B392F0;">super.b</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æˆ‘ä»¬è¿™é‡Œçš„ console.log å°±æ˜¯è®¿é—®å¯¹è±¡æˆå‘˜ logã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆ MemberExpression å¤–å±‚æœ‰ä¸€ä¸ª CallExpression å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼ŒMemberExpression ä¸­çš„æŸä¸€å­ç»“æ„å…·æœ‰å‡½æ•°è°ƒç”¨ï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨è¾¾å¼å°±æˆä¸ºäº†ä¸€ä¸ª Call Expressionã€‚ MemberExpression æœ‰ä¸€ä¸ªå±æ€§ object è¡¨ç¤ºè¢«è®¿é—®çš„å¯¹è±¡ã€‚è¿™é‡Œ console å°±æ˜¯ object çš„å€¼ã€‚ MemberExpression æœ‰ä¸€ä¸ªå±æ€§ property è¡¨ç¤ºå¯¹è±¡çš„å±æ€§ã€‚è¿™é‡Œ log å°±æ˜¯ property çš„å€¼ã€‚ MemberExpression æœ‰ä¸€ä¸ªå±æ€§ computed è¡¨ç¤ºè®¿é—®å¯¹è±¡æ˜¯ä½•ç§æ–¹å¼ã€‚computed ä¸º true è¡¨ç¤º[],false è¡¨ç¤º. ã€‚</p></blockquote><h3 id="identifier" tabindex="-1">Identifier <a class="header-anchor" href="#identifier" aria-hidden="true">#</a></h3><p>Identifer æ˜¯æ ‡è¯†ç¬¦çš„æ„æ€ï¼Œå˜é‡åã€å±æ€§åã€å‚æ•°åç­‰å„ç§å£°æ˜å’Œå¼•ç”¨çš„åå­—ï¼Œéƒ½æ˜¯ Identiferã€‚</p><p>æˆ‘ä»¬è¿™é‡Œçš„ console å°±æ˜¯ä¸€ä¸ª identifierã€‚Identifier æœ‰ä¸€ä¸ªå±æ€§ name è¡¨ç¤ºæ ‡è¯†ç¬¦çš„åå­—</p><h3 id="stringliteral" tabindex="-1">StringLiteral <a class="header-anchor" href="#stringliteral" aria-hidden="true">#</a></h3><p>è¡¨ç¤ºå­—ç¬¦ä¸²å­—é¢é‡ã€‚æˆ‘ä»¬è¿™é‡Œçš„ log å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€‚StringLiteral æœ‰ä¸€ä¸ªå±æ€§ value è¡¨ç¤ºå­—ç¬¦ä¸²çš„å€¼</p><h3 id="å…¬å…±å±æ€§" tabindex="-1">å…¬å…±å±æ€§ <a class="header-anchor" href="#å…¬å…±å±æ€§" aria-hidden="true">#</a></h3><p>æ¯ç§ AST éƒ½æœ‰è‡ªå·±çš„å±æ€§ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿæœ‰ä¸€äº›å…¬å…±çš„å±æ€§ï¼š</p><ul><li>typeï¼šAST èŠ‚ç‚¹çš„ç±»å‹</li><li>startã€endã€locï¼šstart å’Œ end ä»£è¡¨è¯¥èŠ‚ç‚¹åœ¨æºç ä¸­çš„å¼€å§‹å’Œç»“æŸä¸‹æ ‡ã€‚è€Œ loc å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ line å’Œ column å±æ€§åˆ†åˆ«è®°å½•å¼€å§‹å’Œç»“æŸçš„è¡Œåˆ—å·</li><li>leadingCommentsã€innerCommentsã€trailingCommentsï¼šè¡¨ç¤ºå¼€å§‹çš„æ³¨é‡Šã€ä¸­é—´çš„æ³¨é‡Šã€ç»“å°¾çš„æ³¨é‡Šï¼Œæ¯ä¸ª AST èŠ‚ç‚¹ä¸­éƒ½å¯èƒ½å­˜åœ¨æ³¨é‡Šï¼Œè€Œä¸”å¯èƒ½åœ¨å¼€å§‹ã€ä¸­é—´ã€ç»“æŸè¿™ä¸‰ç§ä½ç½®ï¼Œæƒ³æ‹¿åˆ°æŸä¸ª AST çš„æ³¨é‡Šå°±é€šè¿‡è¿™ä¸‰ä¸ªå±æ€§ã€‚</li></ul><h2 id="å¦‚ä½•å†™ä¸€ä¸ª-babel-æ’ä»¶" tabindex="-1">å¦‚ä½•å†™ä¸€ä¸ª babel æ’ä»¶ï¼Ÿ <a class="header-anchor" href="#å¦‚ä½•å†™ä¸€ä¸ª-babel-æ’ä»¶" aria-hidden="true">#</a></h2><p>babel æ’ä»¶æ˜¯ä½œç”¨åœ¨ transform é˜¶æ®µã€‚</p><p>transform é˜¶æ®µæœ‰@babel/traverseï¼Œå¯ä»¥éå† ASTï¼Œå¹¶è°ƒç”¨ visitor å‡½æ•°ä¿®æ”¹ ASTã€‚ æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ª js æ–‡ä»¶ï¼Œå…¶ä¸­å¯¼å‡ºä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å­˜åœ¨ä¸€ä¸ª visitor å±æ€§ï¼Œé‡Œé¢å¯ä»¥ç¼–å†™æˆ‘ä»¬å…·ä½“éœ€è¦ä¿®æ”¹ AST çš„é€»è¾‘ã€‚</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">default</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;@sunny-117/babel-plugin-console&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">visitor</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#E06C75;">å¤åˆ¶ä»£ç </span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">default</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    name</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@sunny-117/babel-plugin-console&quot;</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    visitor</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  };</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"><span style="color:#B392F0;">å¤åˆ¶ä»£ç ;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="æ„é€ -visitor-æ–¹æ³•" tabindex="-1">æ„é€  visitor æ–¹æ³• <a class="header-anchor" href="#æ„é€ -visitor-æ–¹æ³•" aria-hidden="true">#</a></h2><p>path æ˜¯è®°å½•éå†è·¯å¾„çš„ apiï¼Œå®ƒè®°å½•äº†çˆ¶å­èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œè¿˜æœ‰å¾ˆå¤šå¢åˆ æ”¹æŸ¥ AST çš„ api</p><p><img src="`+o+`" alt=""></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">visitor</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">CallExpression</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">path</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;font-style:italic;">opts</span><span style="color:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//å½“traverseéå†åˆ°ç±»å‹ä¸ºCallExpressionçš„ASTæ—¶ï¼Œä¼šè¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹</span></span>
<span class="line"><span style="color:#ABB2BF;">  },</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">visitor</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  CallExpression(path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> { opts }) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//å½“traverseéå†åˆ°ç±»å‹ä¸ºCallExpressionçš„ASTæ—¶ï¼Œä¼šè¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹</span></span>
<span class="line"><span style="color:#B392F0;">  }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æˆ‘ä»¬éœ€è¦éå†æ‰€æœ‰è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ æ‰€ä»¥ä½¿ç”¨ CallExpression ã€‚</p><h2 id="å»é™¤æ‰€æœ‰-console" tabindex="-1">å»é™¤æ‰€æœ‰ console <a class="header-anchor" href="#å»é™¤æ‰€æœ‰-console" aria-hidden="true">#</a></h2><p>å°†æ‰€æœ‰çš„ console.log å»æ‰</p><p>path.get è¡¨ç¤ºè·å–æŸä¸ªå±æ€§çš„ path</p><p>path.matchesPattern æ£€æŸ¥æŸä¸ªèŠ‚ç‚¹æ˜¯å¦ç¬¦åˆæŸç§æ¨¡å¼</p><p>path.remove åˆ é™¤å½“å‰èŠ‚ç‚¹</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#61AFEF;">CallExpression</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;">opts</span><span style="color:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//è·å–calleeçš„path</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">calleePath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;callee&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//æ£€æŸ¥calleeä¸­æ˜¯å¦ç¬¦åˆâ€œconsoleâ€è¿™ç§æ¨¡å¼</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">calleePath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">calleePath</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchesPattern</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;console&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//å¦‚æœç¬¦åˆ ç›´æ¥åˆ é™¤èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">},</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">CallExpression(path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> { opts }) {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//è·å–calleeçš„path</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">calleePath</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.get(</span><span style="color:#FFAB70;">&quot;callee&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//æ£€æŸ¥calleeä¸­æ˜¯å¦ç¬¦åˆâ€œconsoleâ€è¿™ç§æ¨¡å¼</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (calleePath </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">calleePath</span><span style="color:#B392F0;">.matchesPattern(</span><span style="color:#FFAB70;">&quot;console&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//å¦‚æœç¬¦åˆ ç›´æ¥åˆ é™¤èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.remove();</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">}</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="å¢åŠ -env-api" tabindex="-1">å¢åŠ  env api <a class="header-anchor" href="#å¢åŠ -env-api" aria-hidden="true">#</a></h2><p>ä¸€èˆ¬å»é™¤ console.log éƒ½æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ æ‰€ä»¥å¢åŠ  env å‚æ•°</p><p>AST çš„ç¬¬äºŒä¸ªå‚æ•° opt ä¸­æœ‰æ’ä»¶ä¼ å…¥çš„é…ç½®</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">isProduction</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">process</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">env</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">NODE_ENV</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;production&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">CallExpression</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;">opts</span><span style="color:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">env</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">opts</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">env</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;production&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">||</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">isProduction</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">},</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">isProduction</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">process</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">env</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;production&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">CallExpression(path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> { opts }) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> { </span><span style="color:#79B8FF;">env</span><span style="color:#B392F0;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> opts;</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (env </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;production&quot;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">||</span><span style="color:#B392F0;"> isProduction) {</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.remove();</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">}</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="å¢åŠ -exclude-api" tabindex="-1">å¢åŠ  exclude api <a class="header-anchor" href="#å¢åŠ -exclude-api" aria-hidden="true">#</a></h2><p>æˆ‘ä»¬ä¸Šé¢å»é™¤äº†æ‰€æœ‰çš„ consoleï¼Œä¸ç®¡æ˜¯ errorã€warningã€table éƒ½ä¼šæ¸…é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠ ä¸€ä¸ª exclude apiï¼Œä¼ ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥å»é™¤æƒ³è¦å»é™¤çš„ console ç±»å‹</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">isArray</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">prototype</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">toString</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">call</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;[object Array]&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">env</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">exclude</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">opts</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">env</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;production&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">||</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">isProduction</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">removeConsoleExpression</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">calleePath</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">exclude</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">removeConsoleExpression</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">calleePath</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">exclude</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isArray</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">exclude</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">hasTarget</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">exclude</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">some</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">calleePath</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchesPattern</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;console.&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">type</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//åŒ¹é…ä¸Šç›´æ¥è¿”å›ä¸è¿›è¡Œæ“ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">hasTarget</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> isArray </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (arg) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#79B8FF;">Object</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">prototype</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">toString</span><span style="color:#B392F0;">.call(arg) </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;[object Array]&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> { </span><span style="color:#79B8FF;">env</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">exclude</span><span style="color:#B392F0;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> opts;</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (env </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;production&quot;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">||</span><span style="color:#B392F0;"> isProduction) {</span></span>
<span class="line"><span style="color:#B392F0;">  removeConsoleExpression(path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> calleePath</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> exclude);</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> removeConsoleExpression </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> calleePath</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> exclude) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isArray(exclude)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">hasTarget</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">exclude</span><span style="color:#B392F0;">.some((type) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">calleePath</span><span style="color:#B392F0;">.matchesPattern(</span><span style="color:#FFAB70;">&quot;console.&quot;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">+</span><span style="color:#B392F0;"> type);</span></span>
<span class="line"><span style="color:#B392F0;">    });</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//åŒ¹é…ä¸Šç›´æ¥è¿”å›ä¸è¿›è¡Œæ“ä½œ</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasTarget) </span><span style="color:#F97583;">return</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.remove();</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="å¢åŠ -commentwords-api" tabindex="-1">å¢åŠ  commentWords api <a class="header-anchor" href="#å¢åŠ -commentwords-api" aria-hidden="true">#</a></h2><p>æŸäº›æ—¶å€™ æˆ‘ä»¬å¸Œæœ›ä¸€äº› console ä¸è¢«åˆ é™¤ æˆ‘ä»¬å¯ä»¥ç»™ä»–æ·»åŠ ä¸€äº›æ³¨é‡Š æ¯”å¦‚</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#7F848E;font-style:italic;">//no remove</span></span>
<span class="line"><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•1&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•2&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">//reserse</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//hhhhh</span></span>
<span class="line"><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•3&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#6B737C;">//no remove</span></span>
<span class="line"><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;æµ‹è¯•1&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;æµ‹è¯•2&quot;</span><span style="color:#B392F0;">); </span><span style="color:#6B737C;">//reserse</span></span>
<span class="line"><span style="color:#6B737C;">//hhhhh</span></span>
<span class="line"><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;æµ‹è¯•3&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="`+e+`" alt=""></p><p>å¦‚ä¸Š æˆ‘ä»¬å¸Œæœ›å¸¦æœ‰ no remove å‰ç¼€æ³¨é‡Šçš„ console å’Œå¸¦æœ‰ reserse åç¼€æ³¨é‡Šçš„ console ä¿ç•™ä¸è¢«åˆ é™¤ ä¹‹å‰æˆ‘ä»¬æåˆ° babel ç»™æˆ‘ä»¬æä¾›äº† leadingCommentsï¼ˆå‰ç¼€æ³¨é‡Šï¼‰å’Œ trailingCommentsï¼ˆåç¼€æ³¨é‡Šï¼‰æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»–ä»¬ ç”± AST å¯çŸ¥ å¥¹å’Œ CallExpression åŒçº§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è·å–ä»–çš„çˆ¶èŠ‚ç‚¹ ç„¶åè·å–çˆ¶èŠ‚ç‚¹çš„å±æ€§</p><blockquote><p>path.parentPath è·å–çˆ¶ path path.node è·å–å½“å‰èŠ‚ç‚¹</p></blockquote><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">exclude</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">commentWords</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">env</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">opts</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">isFunction</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">prototype</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">toString</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">call</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;[object Function]&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// åˆ¤æ–­æ˜¯å¦æœ‰å‰ç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">hasLeadingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">node</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">leadingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">leadingComments</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">leadingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">leadingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// åˆ¤æ–­æ˜¯å¦æœ‰åç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">hasTrailingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">node</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">trailingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">trailingComments</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">trailingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">trailingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//åˆ¤æ–­æ˜¯å¦æœ‰å…³é”®å­—åŒ¹é… é»˜è®¤no remove || reserve ä¸”å¦‚æœcommentWordså’Œé»˜è®¤å€¼æ˜¯ç›¸æ–¥çš„</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">node</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isFunction</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">commentWords</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">    [</span><span style="color:#98C379;">&quot;CommentBlock&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;CommentLine&quot;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">type</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&amp;&amp;</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#61AFEF;">isArray</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">commentWords</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> /(no</span><span style="color:#D19A66;">[t]?</span><span style="color:#E06C75;"> remove</span><span style="color:#C678DD;">\\b</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">(reserve</span><span style="color:#C678DD;">\\b</span><span style="color:#E06C75;">)/</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">test</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">  );</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">removeConsoleExpression</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">calleePath</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">exclude</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//è·å–çˆ¶path</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentPath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">parentPath</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentPath</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">node</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//æ ‡è¯†æ˜¯å¦æœ‰å‰ç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">leadingReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//æ ‡è¯†æ˜¯å¦æœ‰åç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">trailReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">hasLeadingComments</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">parentNode</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//traverse</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">leadingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">comment</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">comment</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">leadingReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">hasTrailingComments</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">parentNode</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//traverse</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">trailingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">comment</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">comment</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">trailReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//å¦‚æœæ²¡æœ‰å‰ç¼€èŠ‚ç‚¹å’Œåç¼€èŠ‚ç‚¹ ç›´æ¥åˆ é™¤èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#E06C75;">leadingReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">!</span><span style="color:#E06C75;">trailReserve</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> { </span><span style="color:#79B8FF;">exclude</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">commentWords</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">env</span><span style="color:#B392F0;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> opts;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> isFunction </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (arg) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#79B8FF;">Object</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">prototype</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">toString</span><span style="color:#B392F0;">.call(arg) </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;[object Function]&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#6B737C;">// åˆ¤æ–­æ˜¯å¦æœ‰å‰ç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> hasLeadingComments </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (node) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">leadingComments</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.leadingComments;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> leadingComments </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">leadingComments</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">length</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"><span style="color:#6B737C;">// åˆ¤æ–­æ˜¯å¦æœ‰åç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> hasTrailingComments </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (node) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">trailingComments</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.trailingComments;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> trailingComments </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">trailingComments</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">length</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"><span style="color:#6B737C;">//åˆ¤æ–­æ˜¯å¦æœ‰å…³é”®å­—åŒ¹é… é»˜è®¤no remove || reserve ä¸”å¦‚æœcommentWordså’Œé»˜è®¤å€¼æ˜¯ç›¸æ–¥çš„</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> isReserveComment </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (node</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isFunction(commentWords)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> commentWords(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.value);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> (</span></span>
<span class="line"><span style="color:#B392F0;">    [</span><span style="color:#FFAB70;">&quot;CommentBlock&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;CommentLine&quot;</span><span style="color:#B392F0;">].includes(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.type) </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#B392F0;">    (isArray(commentWords)</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">?</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">commentWords</span><span style="color:#B392F0;">.includes(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.value)</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">:</span><span style="color:#FFAB70;"> /(no[t]</span><span style="color:#F97583;">?</span><span style="color:#FFAB70;"> remove</span><span style="color:#F97583;">\\b</span><span style="color:#FFAB70;">)</span><span style="color:#F97583;">|</span><span style="color:#FFAB70;">(reserve</span><span style="color:#F97583;">\\b</span><span style="color:#FFAB70;">)/</span><span style="color:#B392F0;">.test(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.value))</span></span>
<span class="line"><span style="color:#B392F0;">  );</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> removeConsoleExpression </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> calleePath</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> exclude</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//è·å–çˆ¶path</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentPath</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.parentPath;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentPath</span><span style="color:#B392F0;">.node;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//æ ‡è¯†æ˜¯å¦æœ‰å‰ç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> leadingReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">false</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//æ ‡è¯†æ˜¯å¦æœ‰åç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> trailReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">false</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasLeadingComments(parentNode)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//traverse</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">leadingComments</span><span style="color:#B392F0;">.forEach((comment) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isReserveComment(comment</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords)) {</span></span>
<span class="line"><span style="color:#B392F0;">        leadingReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">      }</span></span>
<span class="line"><span style="color:#B392F0;">    });</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasTrailingComments(parentNode)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//traverse</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">trailingComments</span><span style="color:#B392F0;">.forEach((comment) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isReserveComment(comment</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords)) {</span></span>
<span class="line"><span style="color:#B392F0;">        trailReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">      }</span></span>
<span class="line"><span style="color:#B392F0;">    });</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//å¦‚æœæ²¡æœ‰å‰ç¼€èŠ‚ç‚¹å’Œåç¼€èŠ‚ç‚¹ ç›´æ¥åˆ é™¤èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">leadingReserve </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">!</span><span style="color:#B392F0;">trailReserve) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.remove();</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="ç»†èŠ‚å®Œå–„" tabindex="-1">ç»†èŠ‚å®Œå–„ <a class="header-anchor" href="#ç»†èŠ‚å®Œå–„" aria-hidden="true">#</a></h2><p>æˆ‘ä»¬å¤§è‡´å®Œæˆäº†æ’ä»¶ æˆ‘ä»¬å¼•è¿›é¡¹ç›®é‡Œé¢è¿›è¡Œæµ‹è¯•</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯• 1&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//no remove</span></span>
<span class="line"><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯• 2&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯• 3&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">//reserve</span></span>
<span class="line"><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯• 4&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;æµ‹è¯• 1&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#6B737C;">//no remove</span></span>
<span class="line"><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;æµ‹è¯• 2&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;æµ‹è¯• 3&quot;</span><span style="color:#B392F0;">); </span><span style="color:#6B737C;">//reserve</span></span>
<span class="line"><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;æµ‹è¯• 4&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æ–°å»º.babelrc å¼•å…¥æ’ä»¶</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">&quot;plugins&quot;</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">    [</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#98C379;">&quot;../dist/index.cjs&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">&quot;env&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;production&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">{</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F8F8F8;">&quot;plugins&quot;</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> [</span></span>
<span class="line"><span style="color:#B392F0;">    [</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#FFAB70;">&quot;../dist/index.cjs&quot;</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      {</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F8F8F8;">&quot;env&quot;</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;production&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      }</span></span>
<span class="line"><span style="color:#B392F0;">    ]</span></span>
<span class="line"><span style="color:#B392F0;">  ]</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç†è®ºä¸Šåº”è¯¥ç§»é™¤æµ‹è¯• 1ã€æµ‹è¯• 4ï¼Œä½†æ˜¯æˆ‘ä»¬æƒŠè®¶çš„å‘ç° ç«Ÿç„¶ä¸€ä¸ª console æ²¡æœ‰åˆ é™¤ï¼ï¼ç»è¿‡æ’æŸ¥ æˆ‘ä»¬å¤§è‡´ç¡®å®šäº†é—®é¢˜æ‰€åœ¨ã€‚ å› ä¸ºæµ‹è¯• 2 çš„å‰ç¼€æ³¨é‡ŠåŒæ—¶ä¹Ÿè¢« AST çº³å…¥äº†æµ‹è¯• 1 çš„åç¼€æ³¨é‡Šä¸­äº†ï¼Œè€Œæµ‹è¯• 3 çš„åç¼€æ³¨é‡ŠåŒæ—¶ä¹Ÿè¢« AST çº³å…¥äº†æµ‹è¯• 4 çš„å‰ç¼€æ³¨é‡Šä¸­äº† æ‰€ä»¥æµ‹è¯• 1 å­˜åœ¨åç¼€æ³¨é‡Š æµ‹è¯• 4 å­˜åœ¨å‰ç¼€æ³¨é‡Š æ‰€ä»¥æµ‹è¯• 1 å’Œæµ‹è¯• 4 æ²¡æœ‰è¢«åˆ é™¤ é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­å‘¢ï¼Ÿ</p><h3 id="å¯¹äºåç¼€æ³¨é‡Š" tabindex="-1">å¯¹äºåç¼€æ³¨é‡Š <a class="header-anchor" href="#å¯¹äºåç¼€æ³¨é‡Š" aria-hidden="true">#</a></h3><p>æˆ‘ä»¬å¯ä»¥åˆ¤æ–­åç¼€æ³¨é‡Šæ˜¯å¦ä¸å½“å‰çš„è°ƒç”¨è¡¨è¾¾å¼å¤„äºåŒä¸€è¡Œï¼Œå¦‚æœä¸æ˜¯åŒä¸€è¡Œï¼Œåˆ™ä¸å°†å…¶å½’çº³ä¸ºåç¼€æ³¨é‡Š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">hasTrailingComments</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">parentNode</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">: { </span><span style="color:#E06C75;">line</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">currentLine</span><span style="color:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;">  } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">loc</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//traverse</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">trailingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">comment</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">: { </span><span style="color:#E06C75;">line</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">currentCommentLine</span><span style="color:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">loc</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">currentLine</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">currentCommentLine</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">belongCurrentLine</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//å±äºå½“å‰è¡Œæ‰å°†å…¶è®¾ç½®ä¸ºåç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">comment</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">belongCurrentLine</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">trailReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  });</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasTrailingComments(parentNode)) {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    start: { line: </span><span style="color:#79B8FF;">currentLine</span><span style="color:#B392F0;"> }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.loc;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//traverse</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">trailingComments</span><span style="color:#B392F0;">.forEach((comment) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      start: { line: </span><span style="color:#79B8FF;">currentCommentLine</span><span style="color:#B392F0;"> }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.loc;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (currentLine </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> currentCommentLine) {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.belongCurrentLine </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//å±äºå½“å‰è¡Œæ‰å°†å…¶è®¾ç½®ä¸ºåç¼€æ³¨é‡Š</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isReserveComment(comment</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.belongCurrentLine) {</span></span>
<span class="line"><span style="color:#B392F0;">      trailReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">  });</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="å¯¹äºå‰ç¼€æ³¨é‡Š" tabindex="-1">å¯¹äºå‰ç¼€æ³¨é‡Š <a class="header-anchor" href="#å¯¹äºå‰ç¼€æ³¨é‡Š" aria-hidden="true">#</a></h3><p>å› ä¸ºæˆ‘ä»¬åœ¨åç¼€æ³¨é‡Šçš„èŠ‚ç‚¹ä¸­æ·»åŠ äº†ä¸€ä¸ªå˜é‡ belongCurrentLineï¼Œè¡¨ç¤ºè¯¥æ³¨é‡Šæ˜¯å¦æ˜¯å’ŒèŠ‚ç‚¹å±äºåŒä¸€è¡Œã€‚ é‚£ä¹ˆå¯¹äºå‰ç¼€æ³¨é‡Šï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨ belongCurrentLineï¼Œå¦‚æœå­˜åœ¨ belongCurrentLineï¼Œè¡¨ç¤ºä¸èƒ½å°†å…¶å½“ä½œå‰ç¼€æ³¨é‡Šã€‚</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">hasLeadingComments</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">parentNode</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">leadingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">comment</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">comment</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">belongCurrentLine</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">leadingReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  });</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasLeadingComments(parentNode)) {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">leadingComments</span><span style="color:#B392F0;">.forEach((comment) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isReserveComment(comment</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.belongCurrentLine) {</span></span>
<span class="line"><span style="color:#B392F0;">      leadingReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">  });</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="code" tabindex="-1">code <a class="header-anchor" href="#code" aria-hidden="true">#</a></h1><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">isArray</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">prototype</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">toString</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">call</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;[object Array]&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">isFunction</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">prototype</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">toString</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">call</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">arg</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;[object Function]&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">isProduction</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">process</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">env</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">NODE_ENV</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;production&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">node</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isFunction</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">commentWords</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">    [</span><span style="color:#98C379;">&quot;CommentBlock&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;CommentLine&quot;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">type</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&amp;&amp;</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#61AFEF;">isArray</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">commentWords</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> /(no</span><span style="color:#D19A66;">[t]?</span><span style="color:#E06C75;"> remove</span><span style="color:#C678DD;">\\b</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">(reserve</span><span style="color:#C678DD;">\\b</span><span style="color:#E06C75;">)/</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">test</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">  );</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">removeConsoleExpression</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">calleePath</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">exclude</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">// if has exclude key exclude this</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">isArray</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">exclude</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">hasTarget</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">exclude</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">some</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">calleePath</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchesPattern</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;console.&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">type</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">hasTarget</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentPath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">parentPath</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentPath</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">node</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">leadingReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">trailReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">hasLeadingComments</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">parentNode</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//traverse</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">leadingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">comment</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">comment</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&amp;&amp;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">belongCurrentLine</span></span>
<span class="line"><span style="color:#ABB2BF;">      ) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">leadingReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#61AFEF;">hasTrailingComments</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">parentNode</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">: { </span><span style="color:#E06C75;">line</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">currentLine</span><span style="color:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">loc</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//traverse</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">parentNode</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">trailingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">comment</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">: { </span><span style="color:#E06C75;">line</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">currentCommentLine</span><span style="color:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;">      } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">loc</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">currentLine</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">currentCommentLine</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">belongCurrentLine</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">isReserveComment</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">comment</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&amp;&amp;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">comment</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">belongCurrentLine</span></span>
<span class="line"><span style="color:#ABB2BF;">      ) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">trailReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#E06C75;">leadingReserve</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">!</span><span style="color:#E06C75;">trailReserve</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">remove</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// has leading comments</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">hasLeadingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">node</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">leadingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">leadingComments</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">leadingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">leadingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// has trailing comments</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">hasTrailingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">node</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">trailingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">node</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">trailingComments</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">trailingComments</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">trailingComments</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">visitor</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">CallExpression</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">path</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;font-style:italic;">opts</span><span style="color:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">calleePath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;callee&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">exclude</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">commentWords</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">env</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">opts</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">calleePath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">calleePath</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchesPattern</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;console&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">env</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;production&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">||</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">isProduction</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">removeConsoleExpression</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">calleePath</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">exclude</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">commentWords</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  },</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">default</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;@sunny-117/babel-plugin-console&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">visitor</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> isArray </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (arg) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#79B8FF;">Object</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">prototype</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">toString</span><span style="color:#B392F0;">.call(arg) </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;[object Array]&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> isFunction </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (arg) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#79B8FF;">Object</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">prototype</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">toString</span><span style="color:#B392F0;">.call(arg) </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;[object Function]&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">isProduction</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">process</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">env</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;production&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> isReserveComment </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (node</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isFunction(commentWords)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> commentWords(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.value);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> (</span></span>
<span class="line"><span style="color:#B392F0;">    [</span><span style="color:#FFAB70;">&quot;CommentBlock&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;CommentLine&quot;</span><span style="color:#B392F0;">].includes(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.type) </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#B392F0;">    (isArray(commentWords)</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">?</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">commentWords</span><span style="color:#B392F0;">.includes(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.value)</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">:</span><span style="color:#FFAB70;"> /(no[t]</span><span style="color:#F97583;">?</span><span style="color:#FFAB70;"> remove</span><span style="color:#F97583;">\\b</span><span style="color:#FFAB70;">)</span><span style="color:#F97583;">|</span><span style="color:#FFAB70;">(reserve</span><span style="color:#F97583;">\\b</span><span style="color:#FFAB70;">)/</span><span style="color:#B392F0;">.test(</span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.value))</span></span>
<span class="line"><span style="color:#B392F0;">  );</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> removeConsoleExpression </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> calleePath</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> exclude</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">// if has exclude key exclude this</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (isArray(exclude)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">hasTarget</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">exclude</span><span style="color:#B392F0;">.some((type) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">calleePath</span><span style="color:#B392F0;">.matchesPattern(</span><span style="color:#FFAB70;">&quot;console.&quot;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">+</span><span style="color:#B392F0;"> type);</span></span>
<span class="line"><span style="color:#B392F0;">    });</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasTarget) </span><span style="color:#F97583;">return</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentPath</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.parentPath;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentPath</span><span style="color:#B392F0;">.node;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> leadingReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">false</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> trailReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">false</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasLeadingComments(parentNode)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//traverse</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">leadingComments</span><span style="color:#B392F0;">.forEach((comment) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span></span>
<span class="line"><span style="color:#B392F0;">        isReserveComment(comment</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.belongCurrentLine</span></span>
<span class="line"><span style="color:#B392F0;">      ) {</span></span>
<span class="line"><span style="color:#B392F0;">        leadingReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">      }</span></span>
<span class="line"><span style="color:#B392F0;">    });</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (hasTrailingComments(parentNode)) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      start: { line: </span><span style="color:#79B8FF;">currentLine</span><span style="color:#B392F0;"> }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.loc;</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//traverse</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">parentNode</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">trailingComments</span><span style="color:#B392F0;">.forEach((comment) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">        start: { line: </span><span style="color:#79B8FF;">currentCommentLine</span><span style="color:#B392F0;"> }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.loc;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (currentLine </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> currentCommentLine) {</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.belongCurrentLine </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span></span>
<span class="line"><span style="color:#B392F0;">        isReserveComment(comment</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords) </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">comment</span><span style="color:#B392F0;">.belongCurrentLine</span></span>
<span class="line"><span style="color:#B392F0;">      ) {</span></span>
<span class="line"><span style="color:#B392F0;">        trailReserve </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">      }</span></span>
<span class="line"><span style="color:#B392F0;">    });</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">leadingReserve </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">!</span><span style="color:#B392F0;">trailReserve) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.remove();</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#6B737C;">// has leading comments</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> hasLeadingComments </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (node) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">leadingComments</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.leadingComments;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> leadingComments </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">leadingComments</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">length</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#6B737C;">// has trailing comments</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> hasTrailingComments </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (node) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">trailingComments</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">node</span><span style="color:#B392F0;">.trailingComments;</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> trailingComments </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">trailingComments</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">length</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">visitor</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">// @ts-ignore</span></span>
<span class="line"><span style="color:#B392F0;">  CallExpression(path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> { opts }) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">calleePath</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">path</span><span style="color:#B392F0;">.get(</span><span style="color:#FFAB70;">&quot;callee&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> { </span><span style="color:#79B8FF;">exclude</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">commentWords</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">env</span><span style="color:#B392F0;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> opts;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (calleePath </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">calleePath</span><span style="color:#B392F0;">.matchesPattern(</span><span style="color:#FFAB70;">&quot;console&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">)) {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (env </span><span style="color:#F97583;">===</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;production&quot;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">||</span><span style="color:#B392F0;"> isProduction) {</span></span>
<span class="line"><span style="color:#B392F0;">        removeConsoleExpression(path</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> calleePath</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> exclude</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> commentWords);</span></span>
<span class="line"><span style="color:#B392F0;">      }</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">  }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">default</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    name</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@sunny-117/babel-plugin-console&quot;</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    visitor</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  };</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br></div></div>`,68),t=[r];function B(y,F,i,A,m,C){return n(),a("div",null,t)}const d=s(c,[["render",B]]);export{u as __pageData,d as default};
