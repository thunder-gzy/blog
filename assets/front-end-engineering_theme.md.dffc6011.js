import{_ as s,o as n,c as a,a as l}from"./app.f983686f.js";const u=JSON.parse('{"title":"主题切换","description":"","frontmatter":{},"headers":[{"level":2,"title":"前端工程中样式切换的解决方案","slug":"前端工程中样式切换的解决方案","link":"#前端工程中样式切换的解决方案","children":[]},{"level":2,"title":"通过 css 变量实现主题切换及工程化处理","slug":"通过-css-变量实现主题切换及工程化处理","link":"#通过-css-变量实现主题切换及工程化处理","children":[{"level":3,"title":"使用持久化存储","slug":"使用持久化存储","link":"#使用持久化存储","children":[]}]},{"level":2,"title":"跟随系统主题","slug":"跟随系统主题","link":"#跟随系统主题","children":[]}],"relativePath":"front-end-engineering/theme.md","lastUpdated":1715066864000}'),p={name:"front-end-engineering/theme.md"},o=l(`<h1 id="主题切换" tabindex="-1">主题切换 <a class="header-anchor" href="#主题切换" aria-hidden="true">#</a></h1><p><strong>思路：</strong></p><p>前端主题切换，其实就是切换 css</p><p>而且，css 中变换最大的，就是颜色相关的属性，图片，icon....</p><h2 id="前端工程中样式切换的解决方案" tabindex="-1">前端工程中样式切换的解决方案 <a class="header-anchor" href="#前端工程中样式切换的解决方案" aria-hidden="true">#</a></h2><p><strong>1、css 变量 + css 样式【data-set [data-name=&#39;dark&#39;]】class=&#39;dark&#39;</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">primary</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">--</span><span style="color:#E06C75;">vt</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">c</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">bg:#</span><span style="color:#E06C75;">fff</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">dark</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">--</span><span style="color:#E06C75;">vt</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">c</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">bg:#</span><span style="color:#D19A66;">000</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">可以使用js</span><span style="color:#ABB2BF;">，</span><span style="color:#E06C75;">点击某个按钮之后</span><span style="color:#ABB2BF;">，</span><span style="color:#E06C75;">切换根元素的css样式</span><span style="color:#ABB2BF;">，</span><span style="color:#E06C75;">样式切换之后</span><span style="color:#ABB2BF;">，</span><span style="color:#E06C75;">意味着css变量的值改变了</span></span>
<span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">layer</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">background</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">color:</span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;">(--</span><span style="color:#E06C75;">vt</span><span style="color:#ABB2BF;">-c-bg);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">.primary{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">--</span><span style="color:#B392F0;">vt</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">c</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">bg</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#fff;</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">.dark{</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">--</span><span style="color:#B392F0;">vt</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">c</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">bg</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#</span><span style="color:#F8F8F8;">000</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">可以使用js，点击某个按钮之后，切换根元素的css样式，样式切换之后，意味着css变量的值改变了</span></span>
<span class="line"><span style="color:#B392F0;">.layer{</span></span>
<span class="line"><span style="color:#B392F0;">  background</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">color</span><span style="color:#BBBBBB;">:</span><span style="color:#F97583;">var</span><span style="color:#B392F0;">(--vt-c-bg);</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>css 变量，是当我们点击某个按钮的时候做切换，可能如果变换比较大内容较多，会出现白屏的情况</p><p><strong>2、css 预处理器(scss,less,styuls...) + css 样式 [data-set]</strong></p><p>就是使用 css 预处理器强大的预编译功能，简单来说，就是把 css 先写好</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">primary</span><span style="color:#ABB2BF;"> .</span><span style="color:#E06C75;">layer</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  color:#</span><span style="color:#E06C75;">fff</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">dark</span><span style="color:#ABB2BF;"> .</span><span style="color:#E06C75;">layer</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  color:#</span><span style="color:#D19A66;">000</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">primary</span><span style="color:#ABB2BF;"> .</span><span style="color:#E06C75;">container</span><span style="color:#ABB2BF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">dark</span><span style="color:#ABB2BF;"> .</span><span style="color:#E06C75;">container</span><span style="color:#ABB2BF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">primary</span><span style="color:#ABB2BF;"> .</span><span style="color:#E06C75;">link</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;">hover</span><span style="color:#ABB2BF;">{}</span></span>
<span class="line"><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">dark</span><span style="color:#ABB2BF;"> .</span><span style="color:#E06C75;">link</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;">hover</span><span style="color:#ABB2BF;">{}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">primary</span><span style="color:#B392F0;"> .layer{</span></span>
<span class="line"><span style="color:#B392F0;">  color</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#fff</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">dark</span><span style="color:#B392F0;"> .layer{</span></span>
<span class="line"><span style="color:#B392F0;">  color</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#</span><span style="color:#F8F8F8;">000</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">primary</span><span style="color:#B392F0;"> .container{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">dark</span><span style="color:#B392F0;"> .container{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">primary</span><span style="color:#B392F0;"> .link:hover{}</span></span>
<span class="line"><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">dark</span><span style="color:#B392F0;"> .link:hover{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>css 预编译器，一开始，把所有的主题样式涉及到的内容全部写好，当切换的时候，就直接切换了</p><p>这种的方式，可能牺牲的是，一开始的白屏时间</p><h2 id="通过-css-变量实现主题切换及工程化处理" tabindex="-1">通过 css 变量实现主题切换及工程化处理 <a class="header-anchor" href="#通过-css-变量实现主题切换及工程化处理" aria-hidden="true">#</a></h2><h3 id="使用持久化存储" tabindex="-1">使用持久化存储 <a class="header-anchor" href="#使用持久化存储" aria-hidden="true">#</a></h3><p><strong>1、安装 pinia 和持久化插件</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#E06C75;">npm</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">install</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">pinia</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">pinia</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">plugin</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">persistedstate</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">npm install pinia pinia</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">plugin</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">persistedstate</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>2、创建 pinia</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#7F848E;font-style:italic;">//stores/index.ts</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">createPinia</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;pinia&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">piniaPluginPersistedstate</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;pinia-plugin-persistedstate&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// pinia persist</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">pinia</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">createPinia</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">pinia</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">piniaPluginPersistedstate</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">default</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">pinia</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#6B737C;">//stores/index.ts</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { createPinia } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;pinia&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> piniaPluginPersistedstate </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;pinia-plugin-persistedstate&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">// pinia persist</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">pinia</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> createPinia();</span></span>
<span class="line"><span style="color:#79B8FF;">pinia</span><span style="color:#B392F0;">.use(piniaPluginPersistedstate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">default</span><span style="color:#B392F0;"> pinia;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>3、main.ts 中引用</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">createApp</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;vue&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;./style.css&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">App</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;./App.vue&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// pinia store</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">pinia</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;@/stores&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">createApp</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">App</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">pinia</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">mount</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;#app&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { createApp } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;vue&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;./style.css&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> App </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;./App.vue&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#6B737C;">// pinia store</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> pinia </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@/stores&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">createApp(App).use(pinia).mount(</span><span style="color:#FFAB70;">&quot;#app&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>4、设置 pinia 持久化配置</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// config/piniaPersist.ts</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">PersistedStateOptions</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;pinia-plugin-persistedstate&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * </span><span style="color:#C678DD;font-style:italic;">@description</span><span style="color:#7F848E;font-style:italic;"> pinia 持久化参数配置</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * </span><span style="color:#C678DD;font-style:italic;">@param</span><span style="color:#7F848E;font-style:italic;"> </span><span style="color:#E5C07B;font-style:italic;">{String}</span><span style="color:#7F848E;font-style:italic;"> </span><span style="color:#E06C75;font-style:italic;">key</span><span style="color:#7F848E;font-style:italic;"> 存储到持久化的 name</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * </span><span style="color:#C678DD;font-style:italic;">@param</span><span style="color:#7F848E;font-style:italic;"> </span><span style="color:#E5C07B;font-style:italic;">{Array}</span><span style="color:#7F848E;font-style:italic;"> </span><span style="color:#E06C75;font-style:italic;">paths</span><span style="color:#7F848E;font-style:italic;"> 需要持久化的 state name</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * </span><span style="color:#C678DD;font-style:italic;">@return</span><span style="color:#7F848E;font-style:italic;"> persist</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * */</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">piniaPersistConfig</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">key</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">string</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">paths</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">string</span><span style="color:#ABB2BF;">[]) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">persist</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">PersistedStateOptions</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">key</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">storage</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">localStorage</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">// storage: sessionStorage,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">paths</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">persist</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">default</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">piniaPersistConfig</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#6B737C;">// config/piniaPersist.ts</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { PersistedStateOptions } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;pinia-plugin-persistedstate&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">/**</span></span>
<span class="line"><span style="color:#6B737C;"> * </span><span style="color:#F97583;">@description</span><span style="color:#6B737C;"> pinia 持久化参数配置</span></span>
<span class="line"><span style="color:#6B737C;"> * </span><span style="color:#F97583;">@param</span><span style="color:#6B737C;"> </span><span style="color:#B392F0;">{String}</span><span style="color:#6B737C;"> key 存储到持久化的 name</span></span>
<span class="line"><span style="color:#6B737C;"> * </span><span style="color:#F97583;">@param</span><span style="color:#6B737C;"> </span><span style="color:#B392F0;">{Array}</span><span style="color:#6B737C;"> paths 需要持久化的 state name</span></span>
<span class="line"><span style="color:#6B737C;"> * </span><span style="color:#F97583;">@return</span><span style="color:#6B737C;"> persist</span></span>
<span class="line"><span style="color:#6B737C;"> * */</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> piniaPersistConfig </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (key</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">string</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> paths</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">string</span><span style="color:#B392F0;">[]) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">persist</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> PersistedStateOptions </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    key</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    storage</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> localStorage</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">// storage: sessionStorage,</span></span>
<span class="line"><span style="color:#B392F0;">    paths</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  };</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> persist;</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">default</span><span style="color:#B392F0;"> piniaPersistConfig;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>5、创建 global.ts</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">defineStore</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;pinia&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">piniaPersistConfig</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;@/config/piniaPersist&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">GlobalState</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">ObjToKeyValArray</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;@/stores/interface&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">useGlobalStore</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">defineStore</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">id</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;dy-global&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">// 修改默认值之后，需清除 localStorage 数据</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">state</span><span style="color:#ABB2BF;">: (): </span><span style="color:#E5C07B;">GlobalState</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> ({</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">// 深色模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">isDark</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  }),</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">persist</span><span style="color:#ABB2BF;">: </span><span style="color:#61AFEF;">piniaPersistConfig</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;dy-global&quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { defineStore } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;pinia&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> piniaPersistConfig </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@/config/piniaPersist&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { GlobalState</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> ObjToKeyValArray } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@/stores/interface&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">useGlobalStore</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> defineStore({</span></span>
<span class="line"><span style="color:#B392F0;">  id</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;dy-global&quot;</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">// 修改默认值之后，需清除 localStorage 数据</span></span>
<span class="line"><span style="color:#B392F0;">  state</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> ()</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GlobalState </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> ({</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">// 深色模式</span></span>
<span class="line"><span style="color:#B392F0;">    isDark</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">false</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  })</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  persist</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> piniaPersistConfig(</span><span style="color:#FFAB70;">&quot;dy-global&quot;</span><span style="color:#B392F0;">)</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>6、设置 actions 统一的的函数</strong></p><div class="language-diff line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">import { defineStore } from &quot;pinia&quot;;</span></span>
<span class="line"><span style="color:#ABB2BF;">import piniaPersistConfig from &quot;@/config/piniaPersist&quot;;</span></span>
<span class="line"><span style="color:#ABB2BF;">import { GlobalState,ObjToKeyValArray } from &quot;@/stores/interface&quot;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">export const useGlobalStore = defineStore({</span></span>
<span class="line"><span style="color:#ABB2BF;">  id: &quot;dy-global&quot;,</span></span>
<span class="line"><span style="color:#ABB2BF;">  // 修改默认值之后，需清除 localStorage 数据</span></span>
<span class="line"><span style="color:#ABB2BF;">  state: ():GlobalState =&gt; ({</span></span>
<span class="line"><span style="color:#ABB2BF;">    // 深色模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    isDark: false,</span></span>
<span class="line"><span style="color:#ABB2BF;">  }),</span></span>
<span class="line"><span style="color:#98C379;">+  actions: {</span></span>
<span class="line"><span style="color:#98C379;">+    // Set GlobalState</span></span>
<span class="line"><span style="color:#98C379;">+    setGlobalState(...args: ObjToKeyValArray&lt;GlobalState&gt;) {</span></span>
<span class="line"><span style="color:#98C379;">+      this.$patch({ [args[0]]: args[1] });</span></span>
<span class="line"><span style="color:#98C379;">+    }</span></span>
<span class="line"><span style="color:#98C379;">+  },</span></span>
<span class="line"><span style="color:#ABB2BF;">  persist: piniaPersistConfig(&quot;dy-global&quot;)</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">import { defineStore } from &quot;pinia&quot;;</span></span>
<span class="line"><span style="color:#B392F0;">import piniaPersistConfig from &quot;@/config/piniaPersist&quot;;</span></span>
<span class="line"><span style="color:#B392F0;">import { GlobalState,ObjToKeyValArray } from &quot;@/stores/interface&quot;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">export const useGlobalStore = defineStore({</span></span>
<span class="line"><span style="color:#B392F0;">  id: &quot;dy-global&quot;,</span></span>
<span class="line"><span style="color:#B392F0;">  // 修改默认值之后，需清除 localStorage 数据</span></span>
<span class="line"><span style="color:#B392F0;">  state: ():GlobalState =&gt; ({</span></span>
<span class="line"><span style="color:#B392F0;">    // 深色模式</span></span>
<span class="line"><span style="color:#B392F0;">    isDark: false,</span></span>
<span class="line"><span style="color:#B392F0;">  }),</span></span>
<span class="line"><span style="color:#B392F0;">+  actions: {</span></span>
<span class="line"><span style="color:#B392F0;">+    // Set GlobalState</span></span>
<span class="line"><span style="color:#B392F0;">+    setGlobalState(...args: ObjToKeyValArray&lt;GlobalState&gt;) {</span></span>
<span class="line"><span style="color:#B392F0;">+      this.$patch({ [args[0]]: args[1] });</span></span>
<span class="line"><span style="color:#B392F0;">+    }</span></span>
<span class="line"><span style="color:#B392F0;">+  },</span></span>
<span class="line"><span style="color:#B392F0;">  persist: piniaPersistConfig(&quot;dy-global&quot;)</span></span>
<span class="line"><span style="color:#B392F0;">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>7、setGlobalState 函数参数的设定</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">interface</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">GlobalState</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">isDark</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">boolean</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">type</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ObjToKeyValArray</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  [</span><span style="color:#E5C07B;">K</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">keyof</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">]: [</span><span style="color:#E5C07B;">K</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">[</span><span style="color:#E5C07B;">K</span><span style="color:#ABB2BF;">]];</span></span>
<span class="line"><span style="color:#ABB2BF;">}[</span><span style="color:#C678DD;">keyof</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">interface</span><span style="color:#B392F0;"> GlobalState {</span></span>
<span class="line"><span style="color:#B392F0;">  isDark</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">boolean</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">type</span><span style="color:#B392F0;"> ObjToKeyValArray&lt;T&gt; </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  [K </span><span style="color:#F97583;">in</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">keyof</span><span style="color:#B392F0;"> T]</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> [K</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> T[K]];</span></span>
<span class="line"><span style="color:#B392F0;">}[</span><span style="color:#F97583;">keyof</span><span style="color:#B392F0;"> T];</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>8、修改 useTheme</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">useGlobalStore</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;@/stores/modules/global&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">storeToRefs</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;pinia&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">useTheme</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">useGlobalStore</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">isDark</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">storeToRefs</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">globalStore</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">switchTheme</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">init</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Boolean</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#E06C75;">init</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setGlobalState</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;isDark&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">isDark</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">documentElement</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">HTMLElement</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">isDark</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">isDark</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">) </span><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAttribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;class&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;dark&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAttribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;class&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;primary&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">initTheme</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">switchTheme</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">switchTheme</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">initTheme</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { useGlobalStore } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@/stores/modules/global&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { storeToRefs } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;pinia&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> useTheme </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useGlobalStore();</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> { </span><span style="color:#79B8FF;">isDark</span><span style="color:#B392F0;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> storeToRefs(globalStore);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> switchTheme </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (init</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> Boolean) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">init) {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;">.setGlobalState(</span><span style="color:#FFAB70;">&quot;isDark&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">isDark</span><span style="color:#B392F0;">.value);</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">html</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">document</span><span style="color:#B392F0;">.documentElement </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> HTMLElement;</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#79B8FF;">isDark</span><span style="color:#B392F0;">.value)</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">isDark</span><span style="color:#B392F0;">.value) </span><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.setAttribute(</span><span style="color:#FFAB70;">&quot;class&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;dark&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.setAttribute(</span><span style="color:#FFAB70;">&quot;class&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;primary&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> initTheme </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    switchTheme(</span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  };</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    switchTheme</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    initTheme</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>9、界面调用</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">useTheme</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;@/hooks/useTheme&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">initTheme</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">switchTheme</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">useTheme</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">initTheme</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">modeSwitch</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">// const theme = document.documentElement.className</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">// document.documentElement.className = theme === &#39;primary&#39; ? &#39;dark&#39; : &#39;primary&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">switchTheme</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { useTheme } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@/hooks/useTheme&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> { </span><span style="color:#79B8FF;">initTheme</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">switchTheme</span><span style="color:#B392F0;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useTheme();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">initTheme();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> modeSwitch </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">// const theme = document.documentElement.className</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">// document.documentElement.className = theme === &#39;primary&#39; ? &#39;dark&#39; : &#39;primary&#39;</span></span>
<span class="line"><span style="color:#B392F0;">  switchTheme();</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="跟随系统主题" tabindex="-1">跟随系统主题 <a class="header-anchor" href="#跟随系统主题" aria-hidden="true">#</a></h2><p>首先，使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme" target="_blank" rel="noreferrer">媒体查询</a>，可以实现跟随系统主题的效果,其实只有<strong>light</strong>和<strong>dark</strong>两种颜色</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#E06C75;">body</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  margin: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  padding: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">container</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  position: </span><span style="color:#E06C75;">fixed</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  width: </span><span style="color:#D19A66;">100</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  height: </span><span style="color:#D19A66;">100</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  overflow: </span><span style="color:#E06C75;">auto</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  transition:</span><span style="color:#E06C75;">color</span><span style="color:#ABB2BF;"> .5</span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">background</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">color</span><span style="color:#ABB2BF;"> .5</span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  color:#</span><span style="color:#D19A66;">000</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">background</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">color:#</span><span style="color:#E06C75;">fff</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">layout</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  display: </span><span style="color:#E06C75;">flex</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">justify</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">content: </span><span style="color:#E06C75;">center</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">layer</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  width: 300</span><span style="color:#E06C75;">px</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  height: 300</span><span style="color:#E06C75;">px</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  padding: 8</span><span style="color:#E06C75;">px</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  margin: 10</span><span style="color:#E06C75;">px</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  border:1</span><span style="color:#E06C75;">px</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">solid</span><span style="color:#ABB2BF;"> #</span><span style="color:#D19A66;">000</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#61AFEF;">media</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">prefers</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">color</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">scheme</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">dark</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  .</span><span style="color:#E06C75;">container</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    color:#</span><span style="color:#E06C75;">fff</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">background</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">color:#</span><span style="color:#D19A66;">000</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">  .</span><span style="color:#E06C75;">layer</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    border:1</span><span style="color:#E06C75;">px</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">solid</span><span style="color:#ABB2BF;"> #</span><span style="color:#E06C75;">fff</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">body{</span></span>
<span class="line"><span style="color:#B392F0;">  margin</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">0</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  padding</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">0</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">.container{</span></span>
<span class="line"><span style="color:#B392F0;">  position</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> fixed;</span></span>
<span class="line"><span style="color:#B392F0;">  width</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">100</span><span style="color:#F97583;">%</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  height</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">100</span><span style="color:#F97583;">%</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  overflow</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> auto;</span></span>
<span class="line"><span style="color:#B392F0;">  transition</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">color .5s</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> background</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">color .5s;</span></span>
<span class="line"><span style="color:#B392F0;">  color</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#</span><span style="color:#F8F8F8;">000</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  background</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">color</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#fff;</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">.layout{</span></span>
<span class="line"><span style="color:#B392F0;">  display</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> flex;</span></span>
<span class="line"><span style="color:#B392F0;">  justify</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">content</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> center;</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">.layer{</span></span>
<span class="line"><span style="color:#B392F0;">  width</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> 300px;</span></span>
<span class="line"><span style="color:#B392F0;">  height</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> 300px;</span></span>
<span class="line"><span style="color:#B392F0;">  padding</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> 8px;</span></span>
<span class="line"><span style="color:#B392F0;">  margin</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> 10px;</span></span>
<span class="line"><span style="color:#B392F0;">  border</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">1px solid #</span><span style="color:#F8F8F8;">000</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">@media (prefers</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">color</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">scheme: dark) {</span></span>
<span class="line"><span style="color:#B392F0;">  .container{</span></span>
<span class="line"><span style="color:#B392F0;">    color</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#fff;</span></span>
<span class="line"><span style="color:#B392F0;">    background</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">color</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">#</span><span style="color:#F8F8F8;">000</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  .layer{</span></span>
<span class="line"><span style="color:#B392F0;">    border</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;">1px solid #fff;</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>我们可以通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia" target="_blank" rel="noreferrer">api - window.matchMedia</a>，来获取<strong>当前系统主题是深色还是浅色</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#E5C07B;">window</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchMedia</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;(prefers-color-scheme: dark)&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#79B8FF;">window</span><span style="color:#B392F0;">.matchMedia(</span><span style="color:#FFAB70;">&quot;(prefers-color-scheme: dark)&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>有了这个 API，我们完全就没必要修改之前的 css 代码，直接 js 判断</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">media</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">window</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchMedia</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;(prefers-color-scheme: dark)&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">followSystem</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">media</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">matches</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">documentElement</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">className</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;dark&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">documentElement</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">className</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;primary&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">followSystem</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">media</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addEventListener</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;change&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">followSystem</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">media</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">window</span><span style="color:#B392F0;">.matchMedia(</span><span style="color:#FFAB70;">&quot;(prefers-color-scheme: dark)&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> followSystem </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">media</span><span style="color:#B392F0;">.matches) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">document</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">documentElement</span><span style="color:#B392F0;">.className </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;dark&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  } </span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">document</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">documentElement</span><span style="color:#B392F0;">.className </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;primary&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">followSystem();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">media</span><span style="color:#B392F0;">.addEventListener(</span><span style="color:#FFAB70;">&quot;change&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> followSystem);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>直接在 vue3 项目中处理，添加界面系统主题图标，点击激活图标，表示激活跟随系统主题</p><p><strong>1、添加图标</strong></p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">button</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">svg</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">xmlns</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.w3.org/2000/svg&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">viewBox</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;0 0 16 16&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">fill</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;none&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">role</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;img&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">circle</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cx</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;8&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cy</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;8&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">r</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;7.25&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">stroke</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;#5B5B66&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">stroke-width</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.5&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">mask</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;a&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">style</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mask-type:alpha&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">maskUnits</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;userSpaceOnUse&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">x</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">y</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">width</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;16&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">height</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;16&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">circle</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">cx</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;8&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">cy</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;8&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">r</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;7.25&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">fill</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;#5B5B66&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">stroke</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;#5B5B66&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">stroke-width</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.5&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">mask</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">g</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">mask</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;url(#a)&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">fill</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;#5B5B66&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">d</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;M0 0h8v16H0z&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">g</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">svg</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">button</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">css .os-default{ background-color: transparent; border: none; padding: 0; color:</span></span>
<span class="line"><span style="color:#ABB2BF;">var(--main-color); display: flex; justify-content: center; align-items: center;</span></span>
<span class="line"><span style="color:#ABB2BF;">width: 20px; height: 20px; } .os-default-active{ background-color: transparent;</span></span>
<span class="line"><span style="color:#ABB2BF;">border: 1px dotted var(--main-color); padding: 0px; color: var(--main-color);</span></span>
<span class="line"><span style="color:#ABB2BF;">display: flex; justify-content: center; align-items: center; width: 20px;</span></span>
<span class="line"><span style="color:#ABB2BF;">height: 20px; }</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">&lt;</span><span style="color:#FFAB70;">button</span><span style="color:#B392F0;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">  &lt;</span><span style="color:#FFAB70;">svg</span></span>
<span class="line"><span style="color:#B392F0;">    xmlns</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;http://www.w3.org/2000/svg&quot;</span></span>
<span class="line"><span style="color:#B392F0;">    viewBox</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;0 0 16 16&quot;</span></span>
<span class="line"><span style="color:#B392F0;">    fill</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;none&quot;</span></span>
<span class="line"><span style="color:#B392F0;">    role</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;img&quot;</span></span>
<span class="line"><span style="color:#B392F0;">  &gt;</span></span>
<span class="line"><span style="color:#B392F0;">    &lt;</span><span style="color:#FFAB70;">circle</span><span style="color:#B392F0;"> cx</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;8&quot;</span><span style="color:#B392F0;"> cy</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;8&quot;</span><span style="color:#B392F0;"> r</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;7.25&quot;</span><span style="color:#B392F0;"> stroke</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;#5B5B66&quot;</span><span style="color:#B392F0;"> stroke-width</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;1.5&quot;</span><span style="color:#B392F0;"> /&gt;</span></span>
<span class="line"><span style="color:#B392F0;">    &lt;</span><span style="color:#FFAB70;">mask</span></span>
<span class="line"><span style="color:#B392F0;">      id</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;a&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      style</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;mask-type:alpha&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      maskUnits</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;userSpaceOnUse&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      x</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      y</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      width</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;16&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      height</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;16&quot;</span></span>
<span class="line"><span style="color:#B392F0;">    &gt;</span></span>
<span class="line"><span style="color:#B392F0;">      &lt;</span><span style="color:#FFAB70;">circle</span></span>
<span class="line"><span style="color:#B392F0;">        cx</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;8&quot;</span></span>
<span class="line"><span style="color:#B392F0;">        cy</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;8&quot;</span></span>
<span class="line"><span style="color:#B392F0;">        r</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;7.25&quot;</span></span>
<span class="line"><span style="color:#B392F0;">        fill</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;#5B5B66&quot;</span></span>
<span class="line"><span style="color:#B392F0;">        stroke</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;#5B5B66&quot;</span></span>
<span class="line"><span style="color:#B392F0;">        stroke-width</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;1.5&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      /&gt;</span></span>
<span class="line"><span style="color:#B392F0;">    &lt;/</span><span style="color:#FFAB70;">mask</span><span style="color:#B392F0;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">    &lt;</span><span style="color:#FFAB70;">g</span><span style="color:#B392F0;"> mask</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;url(#a)&quot;</span><span style="color:#B392F0;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">      &lt;</span><span style="color:#FFAB70;">path</span><span style="color:#B392F0;"> fill</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;#5B5B66&quot;</span><span style="color:#B392F0;"> d</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;M0 0h8v16H0z&quot;</span><span style="color:#B392F0;"> /&gt;</span></span>
<span class="line"><span style="color:#B392F0;">    &lt;/</span><span style="color:#FFAB70;">g</span><span style="color:#B392F0;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">  &lt;/</span><span style="color:#FFAB70;">svg</span><span style="color:#B392F0;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">&lt;/</span><span style="color:#FFAB70;">button</span><span style="color:#B392F0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">css .os-default{ background-color: transparent; border: none; padding: 0; color:</span></span>
<span class="line"><span style="color:#B392F0;">var(--main-color); display: flex; justify-content: center; align-items: center;</span></span>
<span class="line"><span style="color:#B392F0;">width: 20px; height: 20px; } .os-default-active{ background-color: transparent;</span></span>
<span class="line"><span style="color:#B392F0;">border: 1px dotted var(--main-color); padding: 0px; color: var(--main-color);</span></span>
<span class="line"><span style="color:#B392F0;">display: flex; justify-content: center; align-items: center; width: 20px;</span></span>
<span class="line"><span style="color:#B392F0;">height: 20px; }</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><strong>2、仓库添加属性</strong></p><div class="language-diff line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">export const useGlobalStore = defineStore({</span></span>
<span class="line"><span style="color:#ABB2BF;">  id: &quot;dy-global&quot;,</span></span>
<span class="line"><span style="color:#ABB2BF;">  state: () =&gt; ({</span></span>
<span class="line"><span style="color:#ABB2BF;">    // 深色模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    isDark: false,</span></span>
<span class="line"><span style="color:#98C379;">+    // 系统颜色是否被激活</span></span>
<span class="line"><span style="color:#98C379;">+    osThemeActive: false</span></span>
<span class="line"><span style="color:#ABB2BF;">  }),</span></span>
<span class="line"><span style="color:#ABB2BF;">  getters: {},</span></span>
<span class="line"><span style="color:#ABB2BF;">  actions: {</span></span>
<span class="line"><span style="color:#ABB2BF;">    // Set GlobalState</span></span>
<span class="line"><span style="color:#ABB2BF;">    setGlobalState(...args: ObjToKeyValArray&lt;GlobalState&gt;) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      this.$patch({ [args[0]]: args[1] });</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  },</span></span>
<span class="line"><span style="color:#ABB2BF;">  persist: piniaPersistConfig(&quot;dy-global&quot;)</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">export const useGlobalStore = defineStore({</span></span>
<span class="line"><span style="color:#B392F0;">  id: &quot;dy-global&quot;,</span></span>
<span class="line"><span style="color:#B392F0;">  state: () =&gt; ({</span></span>
<span class="line"><span style="color:#B392F0;">    // 深色模式</span></span>
<span class="line"><span style="color:#B392F0;">    isDark: false,</span></span>
<span class="line"><span style="color:#B392F0;">+    // 系统颜色是否被激活</span></span>
<span class="line"><span style="color:#B392F0;">+    osThemeActive: false</span></span>
<span class="line"><span style="color:#B392F0;">  }),</span></span>
<span class="line"><span style="color:#B392F0;">  getters: {},</span></span>
<span class="line"><span style="color:#B392F0;">  actions: {</span></span>
<span class="line"><span style="color:#B392F0;">    // Set GlobalState</span></span>
<span class="line"><span style="color:#B392F0;">    setGlobalState(...args: ObjToKeyValArray&lt;GlobalState&gt;) {</span></span>
<span class="line"><span style="color:#B392F0;">      this.$patch({ [args[0]]: args[1] });</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">  },</span></span>
<span class="line"><span style="color:#B392F0;">  persist: piniaPersistConfig(&quot;dy-global&quot;)</span></span>
<span class="line"><span style="color:#B392F0;">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>添加了属性，就必须修改 GlobalState 的 ts 配置</p><div class="language-diff line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">export interface GlobalState {</span></span>
<span class="line"><span style="color:#ABB2BF;">  isDark: boolean;</span></span>
<span class="line"><span style="color:#98C379;">+  osThemeActive: boolean;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">export type ObjToKeyValArray&lt;T&gt; = {</span></span>
<span class="line"><span style="color:#ABB2BF;">  [K in keyof T]: [K, T[K]];</span></span>
<span class="line"><span style="color:#ABB2BF;">}[keyof T];</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#B392F0;">export interface GlobalState {</span></span>
<span class="line"><span style="color:#B392F0;">  isDark: boolean;</span></span>
<span class="line"><span style="color:#B392F0;">+  osThemeActive: boolean;</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">export type ObjToKeyValArray&lt;T&gt; = {</span></span>
<span class="line"><span style="color:#B392F0;">  [K in keyof T]: [K, T[K]];</span></span>
<span class="line"><span style="color:#B392F0;">}[keyof T];</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>3、点击修改 css 样式</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">useTheme</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;@/hooks/useTheme&#39;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">useGlobalStore</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;@/stores/modules/global&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">useGlobalStore</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> {</span><span style="color:#E5C07B;">initTheme</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">switchTheme</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">activeOSTheme</span><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">useTheme</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">initTheme</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">modeSwitch</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">switchTheme</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">osThemeSwitch</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">activeOSTheme</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//html</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">button</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">:class=&quot;globalStore.osThemeActive</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;os-default-active&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;os-default&#39;&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">  &lt;svg xmlns=&quot;</span><span style="color:#FFFFFF;">http://www.w3.org/2000/svg&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;font-style:italic;">viewBox</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;0 0 16 16&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;font-style:italic;">fill</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;none&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;font-style:italic;">role</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;img&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">@click=&quot;osThemeSwitch&quot;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#FFFFFF;">......省略</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#FFFFFF;">&lt;/svg&gt;</span></span>
<span class="line"><span style="color:#FFFFFF;">&lt;/button&gt;</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { useTheme } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&#39;@/hooks/useTheme&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { useGlobalStore } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@/stores/modules/global&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useGlobalStore();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> {</span><span style="color:#79B8FF;">initTheme</span><span style="color:#BBBBBB;">,</span><span style="color:#79B8FF;">switchTheme</span><span style="color:#BBBBBB;">,</span><span style="color:#79B8FF;">activeOSTheme</span><span style="color:#B392F0;">} </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useTheme();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">initTheme();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> modeSwitch </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  switchTheme()</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> osThemeSwitch </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  activeOSTheme();</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">//html</span></span>
<span class="line"><span style="color:#B392F0;">&lt;</span><span style="color:#FFAB70;">button</span><span style="color:#B392F0;"> :class=&quot;globalStore.osThemeActive ? </span><span style="color:#FFAB70;">&#39;os-default-active&#39;</span><span style="color:#B392F0;"> : </span><span style="color:#FFAB70;">&#39;os-default&#39;&quot;&gt;</span></span>
<span class="line"><span style="color:#FFAB70;">  &lt;svg xmlns=&quot;</span><span style="color:#B392F0;">http://www.w3.org/2000/svg&quot; viewBox</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;0 0 16 16&quot;</span><span style="color:#B392F0;"> fill</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;none&quot;</span><span style="color:#B392F0;"> role</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">&quot;img&quot;</span><span style="color:#B392F0;"> @click=&quot;osThemeSwitch&quot;&gt;</span></span>
<span class="line"><span style="color:#B392F0;">	......省略</span></span>
<span class="line"><span style="color:#B392F0;">  &lt;/svg&gt;</span></span>
<span class="line"><span style="color:#B392F0;">&lt;/button&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>4、修改 useTheme.ts</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code-dark"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">useGlobalStore</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;@/stores/modules/global&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">storeToRefs</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;pinia&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">watchEffect</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;vue&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">media</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">window</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchMedia</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;(prefers-color-scheme: dark)&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">useTheme</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">useGlobalStore</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">isDark</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">osThemeActive</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">storeToRefs</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">globalStore</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">switchTheme</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">init</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Boolean</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//init参数为true时，表示是初始化页面或者直接跟随系统主题</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//这个时候不需要手动切换明暗主题，也不需要将跟随系统主题设置为false</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#E06C75;">init</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setGlobalState</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;isDark&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">isDark</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;">//如果是直接点击切换明暗主题，那么跟随系统主题激活切换为false</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setGlobalState</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;osThemeActive&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">documentElement</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">HTMLElement</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">isDark</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">) </span><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAttribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;class&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;dark&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAttribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;class&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;primary&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">//点击激活需要改变osThemeActive的值</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">activeOSTheme</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setGlobalState</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;osThemeActive&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">osThemeActive</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">followSystem</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">followSystem</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">isOsDark</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">window</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">matchMedia</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;(prefers-color-scheme: dark)&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">matches</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//跟随系统主题设置明暗</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">globalStore</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setGlobalState</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;isDark&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">isOsDark</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">switchTheme</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">watchEffect</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">//系统主题切换，需要监听change事件</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">osThemeActive</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">media</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addEventListener</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;change&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">followSystem</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">media</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">removeEventListener</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;change&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">followSystem</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">initTheme</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">switchTheme</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">switchTheme</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">initTheme</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">activeOSTheme</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { useGlobalStore } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;@/stores/modules/global&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { storeToRefs } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;pinia&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> { watchEffect } </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;vue&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">media</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">window</span><span style="color:#B392F0;">.matchMedia(</span><span style="color:#FFAB70;">&#39;(prefers-color-scheme: dark)&#39;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> useTheme </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useGlobalStore();</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> { </span><span style="color:#79B8FF;">isDark</span><span style="color:#BBBBBB;">,</span><span style="color:#79B8FF;">osThemeActive</span><span style="color:#B392F0;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> storeToRefs(globalStore);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> switchTheme </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (init</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> Boolean) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//init参数为true时，表示是初始化页面或者直接跟随系统主题</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//这个时候不需要手动切换明暗主题，也不需要将跟随系统主题设置为false</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">init) {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;">.setGlobalState(</span><span style="color:#FFAB70;">&quot;isDark&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">isDark</span><span style="color:#B392F0;">.value);</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#6B737C;">//如果是直接点击切换明暗主题，那么跟随系统主题激活切换为false</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;">.setGlobalState(</span><span style="color:#FFAB70;">&quot;osThemeActive&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">false</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">html</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">document</span><span style="color:#B392F0;">.documentElement </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> HTMLElement;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">isDark</span><span style="color:#B392F0;">.value) </span><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.setAttribute(</span><span style="color:#FFAB70;">&quot;class&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;dark&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">html</span><span style="color:#B392F0;">.setAttribute(</span><span style="color:#FFAB70;">&quot;class&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;primary&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#6B737C;">//点击激活需要改变osThemeActive的值</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> activeOSTheme </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;">.setGlobalState(</span><span style="color:#FFAB70;">&quot;osThemeActive&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">osThemeActive</span><span style="color:#B392F0;">.value);</span></span>
<span class="line"><span style="color:#B392F0;">    followSystem();</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> followSystem </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">isOsDark</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">window</span><span style="color:#B392F0;">.matchMedia(</span><span style="color:#FFAB70;">&#39;(prefers-color-scheme: dark)&#39;</span><span style="color:#B392F0;">).matches;</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//跟随系统主题设置明暗</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">globalStore</span><span style="color:#B392F0;">.setGlobalState(</span><span style="color:#FFAB70;">&quot;isDark&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> isOsDark);</span></span>
<span class="line"><span style="color:#B392F0;">    switchTheme(</span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  watchEffect(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">//系统主题切换，需要监听change事件</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">osThemeActive</span><span style="color:#B392F0;">.value) {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">media</span><span style="color:#B392F0;">.addEventListener(</span><span style="color:#FFAB70;">&#39;change&#39;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> followSystem);</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">media</span><span style="color:#B392F0;">.removeEventListener(</span><span style="color:#FFAB70;">&#39;change&#39;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> followSystem);</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> initTheme </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    switchTheme(</span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    switchTheme</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    initTheme</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    activeOSTheme</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><blockquote><p>所有源码均在：<a href="https://github.com/Sunny-117/blog/tree/main/code/theme-switch" target="_blank" rel="noreferrer">https://github.com/Sunny-117/blog/tree/main/code/theme-switch</a></p></blockquote>`,52),e=[o];function c(t,r,B,y,i,F){return n(),a("div",null,e)}const b=s(p,[["render",c]]);export{u as __pageData,b as default};
